<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SiwRecipes - Ricetta</title>
	<!-- Icone -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<!-- CSS Files -->
	<link rel="stylesheet" th:href="@{/theme.css}" href="theme.css">

	<!-- CSS Specifici per questa pagina -->
	<link rel="stylesheet" th:href="@{/recipe.css}" href="recipe.css">
	<link rel="stylesheet" th:href="@{/review.css}" href="review.css">
</head>

<body>

	<div class="app-container">

		<!-- SIDEBAR -->
		<aside class="sidebar">
			<div class="brand">
				<div class="logo-icon"><i class="fa-solid fa-bread-slice"></i></div>
				<h1>SiwRecipes</h1>
			</div>

			<nav class="sidebar-menu">
				<div class="menu-section">
					<span class="menu-label">MENU PRINCIPALE</span>
					<ul>
						<li><a th:href="@{/}"><i class="fa-solid fa-house"></i> Home</a></li>
						<li class="active"><a th:href="@{#}"><i class="fa-solid fa-utensils"></i> Esplora Ricette</a></li>
						<li><a th:href="@{#}"><i class="fa-solid fa-star"></i> Esplora Recensioni</a>
						</li>
					</ul>
				</div>

				<div class="menu-section">
					<span class="menu-label">LA MIA CUCINA</span>
					<ul>
						<!--Visibile SEMPRE, accessibile SOLO SE AUTENTICATO (vedi auth config)-->
						<li><a th:href="@{#}"><i class="fa-solid fa-book-open"></i> Le Mie Ricette</a></li>
						<li><a th:href="@{#}"><i class="fa-regular fa-comment"></i> Le Mie Recensioni</a></li>
					</ul>
				</div>

				<!-- Mostra SOLO se autenticato come AMMINISTRATORE-->
				<div class="menu-section" th:if="${isAdmin}">
					<span class="menu-label">AMMINISTRAZIONE</span>
					<ul>
						<li><a th:href="@{/admin/categoryPanel}"><i class="fa-solid fa-tags"></i> Gestisci
								Categorie</a></li>
						<li><a th:href="@{#}"><i class="fa-solid fa-users"></i> Gestione Utenti</a></li>
					</ul>
				</div>
			</nav>

			<div class="user-profile">
				<a th:href="@{/profile}"><img th:src="${currentUser?.urlImage} ?: ${defaultProfileUrlImage}"
						class="user-avatar-sb"></a>
				<div class="user-info">
					<a th:href="@{/profile}"><span class="user-name" th:text="${currentUser?.firstName} ?: 'Accedi'"
							}></span></a>
					<a th:href="@{/profile}" class="user-role" th:if="${isAdmin}">Admin</a>
					<a th:href="@{/profile}" class="user-role" th:unless="${isAdmin}">Visualizza profilo</a>
				</div>

				<a th:href="@{/logout}" class="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i></a>
			</div>
		</aside>

		<!-- MAIN CONTENT -->
		<!-- Override padding 0 per far estendere l'immagine hero -->
		<main class="main-content" style="padding: 0;">

			<!-- HERO SECTION -->
			<div class="recipe-hero"
				th:style="'background-image: url(' + (${recipe.urlImage} ?: ${defaultRecipeUrlImage}) + ');'">
				<div class="hero-overlay">
					<div class="hero-badges">
						<div class="hero-badge badge-primary">
							<span class="badge-label">Categoria</span>
							<span th:text="${recipe.category.name}"></span>
						</div>

						<div class=" hero-badge badge-dark">
							<span class="badge-label">Difficolt√†</span>
							<span th:text="${recipe.difficulty}"></span>
						</div>

						<div class="hero-badge badge-dark">
							<span class="badge-label">Tempo</span>
							<span th:text="${recipe.prepTime} + ' Minuti'"></span>
						</div>
					</div>
					<h1 class="hero-title" th:text="${recipe.title}"></h1>
				</div>
			</div>

			<!-- CONTENT GRID -->
			<div class="recipe-container">

				<!-- COLONNA SINISTRA (Contenuto) -->
				<div class="recipe-main">

					<h2 class="section-title">Descrizione</h2>
					<div class="recipe-description">
						<p th:text="${recipe.shortDescription}"></p>
					</div>

					<h2 class="section-title">Preparazione</h2>
					<div class="recipe-description">
						<p th:text="${recipe.instructions}"></p>
					</div>

					<!-- REVIEWS SECTION -->
					<div class="reviews-section">
						<div class="reviews-header">
							<h2 class="section-title" style="margin:0;"
								th:text="'Recensioni (' + ${#lists.size(recipe.reviews)} + ')'">Recensioni (0)</h2>
							<a th:href="@{/formNewReview/{id}(id=${recipe.id})}"><button class="btn btn-outline">Scrivi
									recensione</button></a>
						</div>

						<div class="review-card" th:each="r : ${recipe.reviews}">
							<div class="review-header">
								<div class="reviewer-info">
									<img th:src="${r.author.urlImage}" class="avatar">
									<div>
										<span class="reviewer-name" th:text="${r.author.credentials.username}"></span>
										<span class="review-date"
											th:text="${#temporals.format(r.creationDate, 'dd MMMM yyyy')}"></span>
									</div>
								</div>
								<div class="review-stars">
									<i th:each="num : ${#numbers.sequence(1, 5)}"
										th:class="${num <= r.rating} ? 'fa-solid fa-star' : 'fa-regular fa-star'"></i>
								</div>
							</div>
							<div class="review-body" th:text="${r.text}"></div>
							<div class="review-actions"
								th:if="${isAdmin or (currentUser != null and currentUser.id == r.author.id)}">
								<a th:href="@{/editReview/{reviewId}(reviewId=${r.id})}" th:if="${currentUser != null and currentUser.id == r.author.id}">
									<button class="review-action-btn action-edit">
										<i class="fa-solid fa-pen"></i>Modifica
									</button>
								</a>
								<a th:href="@{/deleteReview/{reviewId}(reviewId=${r.id})}">
									<button class="review-action-btn action-delete">
										<i class="fa-regular fa-trash-can"></i>Elimina
									</button>
								</a>
							</div>
						</div>
					</div>
				</div>

				<!-- COLONNA DESTRA (Sidebar Widget) -->
				<aside class="recipe-sidebar">

					<!-- Bottoni Azione -->
					<div class="recipe-actions"
						th:if="${isAdmin or (currentUser != null and currentUser.id == recipe.author.id)}">
						<a th:href="@{/editRecipe/{id}(id=${recipe.id})}" th:if="${currentUser != null and currentUser.id == recipe.author.id}">
							<button class="btn btn-primary" style="flex: 1;">
								<i class="fa-solid fa-pen"></i> Modifica Ricetta
							</button>
						</a>
						<a th:href="@{/deleteRecipe/{id}(id=${recipe.id})}">
							<button class="btn btn-delete-recipe" title="Elimina Ricetta">
								<i class="fa-regular fa-trash-can"></i> Elimina
							</button>
						</a>
					</div>

					<!-- Autore -->
					<div class="widget-box">
						<h4 class="widget-title"></h4>
						<div class="author-widget">
							<img th:src="${recipe.author.urlImage} ?: ${defaultProfileUrlImage}"
								class="author-avatar-lg">
							<div class="author-details">
								<h4 th:text="${recipe.author.credentials.username}"></h4>
								<span class="author-role" th:if="${recipe.author.credentials.role == 'ADMIN' }"
									th:text="${recipe.author.credentials.role}">Chef Appassionato</span>
							</div>
						</div>
						<div class="publish-date">
							<i class="fa-regular fa-calendar"
								th:text="${' Pubblicata il ' + #temporals.format(recipe.creationDate, 'dd MMMM yyyy')}"></i>
						</div>
					</div>

					<!-- Ingredienti -->
					<div class="widget-box">
						<h4 class="widget-title">Ingredienti</h4>
						<ul class="ingredient-list">
							<li class="ingredient-item" th:each="i : ${recipe.ingredients}">
								<span th:text="${i.name}"></span>
								<span class="ingredient-qty" th:text="${i.quantity +' '+ i.unit}"></span>
							</li>
						</ul>
					</div>

				</aside>
			</div>

		</main>
	</div>

</body>

</html>