<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SiwRecipe - Modifica Ricetta</title>

	<!-- Icone -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<!-- CSS Globale -->
	<link rel="stylesheet" th:href="@{/theme.css}">
	<link rel="stylesheet" th:href="@{/adminScreen.css}">
	<link rel="stylesheet" th:href="@{/recipe.css}">
</head>

<body>

	<div class="app-container">

		<!-- SIDEBAR -->
		<aside class="sidebar">
			<div class="brand">
				<div class="logo-icon"><i class="fa-solid fa-bread-slice"></i></div>
				<h1>SiwRecipes</h1>
			</div>

			<nav class="sidebar-menu">
				<div class="menu-section">
					<span class="menu-label">MENU PRINCIPALE</span>
					<ul>
						<li class="active"><a href="#"><i class="fa-solid fa-house"></i> Esplora Ricette</a></li>

						<!--Visibile SEMPRE, accessibile SOLO SE AUTENTICATO (vedi auth config)-->
						<li><a href="#"><i class="fa-solid fa-book-open"></i> Le Mie Ricette</a></li>
						<!--<li><a href="#"><i class="fa-regular fa-heart"></i> Preferiti</a></li>-->
						<li><a href="#"><i class="fa-regular fa-comment"></i> Le Mie Recensioni</a></li>
					</ul>
				</div>

				<!-- Mostra SOLO se autenticato come AMMINISTRATORE-->
				<div class="menu-section" th:if="${isAdmin}">
					<span class="menu-label">AMMINISTRAZIONE</span>
					<ul>
						<li><a href="#"><i class="fa-solid fa-shield-halved"></i> Moderazione</a></li>
						<li><a href="#"><i class="fa-solid fa-users"></i> Gestione Utenti</a></li>
					</ul>
				</div>
			</nav>

			<div class="user-profile">
				<a href="/profile"><img th:src="${currentUser?.urlImage} ?: ${defaultProfileUrlImage}"
						class="user-avatar-sb"></a>
				<div class="user-info">
					<a href="/profile"><span class="user-name" th:text="${currentUser?.firstName} ?: 'Accedi'"
							}></span></a>
					<a href="/profile" class="user-role" th:if="${isAdmin}">Admin</a>
					<a href="/profile" class="user-role" th:unless="${isAdmin}">Visualizza profilo</a>
				</div>

				<a href="/logout" class="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i></a>
			</div>
		</aside>

		<!-- MAIN CONTENT -->
		<main class="main-content">

			<!-- HEADER: Titolo e Bottoni Azione -->
			<header class="editor-top-bar">
				<h2 class="editor-title">Modifica una Ricetta</h2>
				<p class="editor-subtitle">Condividi le tue ricette più sfiziose con una community di appassionati!
				</p>
			</header>

			<!-- CARD BIANCA EDITOR -->
			<div class="editor-card">

				<!-- Admin Grid Layout -->
				<div class="admin-grid">
					<section class="admin-list-section">
						<div class="list-header">
							<h3 th:text="'Elenco Ingredienti (' + ${#lists.size(recipe.ingredients)} + ')'">Elenco
								Ingredienti (0)</h3>
						</div>

						<div class="admin-table-container">
							<table class="admin-table">
								<thead>
									<tr>
										<th width="55%">Nome Ingrediente</th>
										<th width="20%">Quantità</th>
										<th width="25%" style="text-align: right;">Unità</th>
									</tr>
								</thead>
								<tbody>
									<!-- Riga 1 -->
									<tr th:each="i, stat: ${recipe.ingredients}" th:if="${i.name!=null}">
										<td class="col-primary" th:text="${i.name}"></td>
										<td th:text="${i.quantity}"></td>
										<td th:text="${i.unit}"></td>
										<td>
											<div class="action-buttons">
												<a
													th:href="@{/removeRecipeIngredient/{id}/{index}(id=${recipe.id},index=${stat.index})}"><button
														class="btn-icon btn-delete" title="Elimina">
														<i class="fa-regular fa-trash-can"></i>
													</button></a>
												<!-- AGGIUNGI ELIMINA INGREDIENTE -->
											</div>
										</td>
									</tr>

								</tbody>
							</table>
						</div>
					</section>

					<section class="admin-form-section">
						<div class="form-card">
							<h3>Aggiungi Ingrediente</h3>

							<!-- AGGIUNGI CHECK ERRORI PER INSERIMENTO NUOVA CATGORIA (come cat già esistente) -->

							<p class="form-desc">Inserisci gli ingredienti e le rispettive dosi per la tua ricetta, così
								che tutti possano replicarla!</p>

							<form th:action="@{/confirmNewIngredientEdit/{id}(id=${recipe.id})}" method="POST"
								th:object="${recipe}">
								<input type="hidden" name="ingIndex" th:value="${ingIndex}" />
								<div class="col-name">
									<input type="text" class="form-control" placeholder="Nome ingrediente (es. Farina)"
										th:field="*{ingredients[__${ingIndex}__].name}">
								</div>
								<div class="col-qty">
									<input type="number" class="form-control" placeholder="Q.tà"
										th:field="*{ingredients[__${ingIndex}__].quantity}">
								</div>
								<div class="col-unit">
									<select class="form-control" th:field="*{ingredients[__${ingIndex}__].unit}">
										<option value="(g)">Grammi (g)</option>
										<option value="(ml)">Millilitri (ml)</option>
										<option value="(pz)">Pezzi (pz)</option>
										<option value="Cucchiai">Cucchiai</option>
										<option value="Pizzichi">Pizzichi</option>
									</select>
								</div>

								<button type="submit" class="btn btn-primary" style="width: 100%;">
									<i class="fa-solid fa-plus"></i>Aggiungi
								</button>



								<a th:href="@{/}" class="link-cancel side-form-btn">Home</a>

								<a th:href="@{/confirmRecipeEditUltimated/{id}(id=${recipe.id})}"
									class="btn btn-second side-form-btn">
									<i class="fa-regular fa-floppy-disk"></i> Pubblica Ricetta
								</a>


							</form>
						</div>
					</section>

				</div>
			</div>
		</main>
	</div>

</body>

</html>